# =============================================================================
# LLM Observatory - Production Environment Configuration
# =============================================================================
#
# IMPORTANT SECURITY NOTES:
# 1. DO NOT commit this file with actual secrets to version control
# 2. Copy to .env.production and fill in with real values
# 3. Use external secret management (AWS Secrets Manager, HashiCorp Vault, etc.)
# 4. Generate strong random values for all secrets
# 5. Rotate secrets regularly
# 6. Limit access to this file (chmod 600)
#
# To generate secure random values:
#   openssl rand -hex 32        # For keys and secrets
#   openssl rand -base64 32     # For passwords
#   uuidgen                     # For UUIDs
#
# =============================================================================

# =============================================================================
# Environment Settings
# =============================================================================
ENVIRONMENT=production
COMPOSE_PROJECT_NAME=llm-observatory

# Data directory for persistent volumes (must exist and have proper permissions)
DATA_DIR=/var/lib/llm-observatory

# =============================================================================
# TimescaleDB Primary Database Configuration
# =============================================================================

# Connection settings
DB_PORT=5432
DB_NAME=llm_observatory

# SECURITY: These should be loaded from Docker secrets or external secret manager
# DO NOT use default values in production!
# DB_USER=                    # Loaded from secrets/db_user.txt
# DB_PASSWORD=                # Loaded from secrets/db_password.txt
# DB_APP_PASSWORD=            # Loaded from secrets/db_app_password.txt
# DB_READONLY_PASSWORD=       # Loaded from secrets/db_readonly_password.txt

# SSL/TLS Configuration
DB_SSL_MODE=require           # Options: disable, allow, prefer, require, verify-ca, verify-full

# Performance tuning for production (adjust based on server specs)
# Example values for a 16GB RAM server:
DB_SHARED_BUFFERS=4GB
DB_WORK_MEM=64MB
DB_MAINTENANCE_WORK_MEM=512MB
DB_EFFECTIVE_CACHE_SIZE=12GB
DB_MAX_WAL_SIZE=4GB
DB_MIN_WAL_SIZE=1GB

# Replication settings
DB_MAX_WAL_SENDERS=10
DB_MAX_REPLICATION_SLOTS=10

# Connection pool settings
DB_POOL_MIN_SIZE=10
DB_POOL_MAX_SIZE=50
DB_POOL_TIMEOUT=30
DB_CONNECT_TIMEOUT=10
DB_IDLE_TIMEOUT=600
DB_MAX_LIFETIME=1800

# =============================================================================
# TimescaleDB Read Replica Configuration
# =============================================================================
DB_REPLICA_PORT=5433

# Replica performance tuning (adjust based on server specs)
# Example values for an 8GB RAM server:
DB_REPLICA_SHARED_BUFFERS=2GB
DB_REPLICA_EFFECTIVE_CACHE_SIZE=6GB

# =============================================================================
# Redis Configuration
# =============================================================================

# Connection settings
REDIS_PORT=6379
REDIS_SENTINEL_PORT=26379

# SECURITY: Load from secrets
# REDIS_PASSWORD=              # Loaded from secrets/redis_password.txt

# Cache TTL settings (in seconds)
CACHE_DEFAULT_TTL=3600        # 1 hour
CACHE_SHORT_TTL=300           # 5 minutes
CACHE_LONG_TTL=86400          # 24 hours

# Redis pool settings
REDIS_POOL_SIZE=100
REDIS_TIMEOUT=5

# =============================================================================
# Grafana Configuration
# =============================================================================

GRAFANA_PORT=3000
GRAFANA_ROOT_URL=https://observatory.yourdomain.com
GRAFANA_DOMAIN=observatory.yourdomain.com

# Database for Grafana metadata
GRAFANA_DB_NAME=grafana

# SECURITY: Load from secrets
# GRAFANA_ADMIN_USER=          # Loaded from secrets/grafana_admin_user.txt
# GRAFANA_ADMIN_PASSWORD=      # Loaded from secrets/grafana_admin_password.txt
# GRAFANA_SECRET_KEY=          # Loaded from secrets/grafana_secret_key.txt

# =============================================================================
# API Server Configuration
# =============================================================================

API_PORT=8080
API_REPLICAS=2                # Number of API server replicas

# Workers (adjust based on CPU cores)
APP_WORKERS=4

# SECURITY: Load from secrets
# SECRET_KEY=                  # Loaded from secrets/secret_key.txt
# JWT_SECRET=                  # Loaded from secrets/jwt_secret.txt

# JWT settings
JWT_ALGORITHM=HS256
JWT_EXPIRATION=3600           # 1 hour

# CORS settings (comma-separated origins)
CORS_ORIGINS=https://observatory.yourdomain.com,https://api.observatory.yourdomain.com

# =============================================================================
# Collector Service Configuration
# =============================================================================

# Worker settings
COLLECTOR_WORKERS=4
COLLECTOR_BATCH_SIZE=1000
COLLECTOR_FLUSH_INTERVAL=10   # seconds
COLLECTOR_QUEUE_SIZE=10000

# OpenTelemetry endpoints
OTLP_GRPC_PORT=4317
OTLP_HTTP_PORT=4318

# =============================================================================
# Nginx Reverse Proxy Configuration
# =============================================================================

HTTP_PORT=80
HTTPS_PORT=443

# =============================================================================
# Logging Configuration
# =============================================================================

# Application logging
LOG_LEVEL=info                # Options: trace, debug, info, warn, error
LOG_FORMAT=json
RUST_LOG=info

# Structured logging
LOG_STRUCTURED=true

# =============================================================================
# Rate Limiting Configuration
# =============================================================================

RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100       # Requests per window
RATE_LIMIT_WINDOW=60          # Window in seconds
RATE_LIMIT_STORAGE=redis

# =============================================================================
# Observability Configuration
# =============================================================================

# Metrics
METRICS_ENABLED=true
METRICS_PORT=9090

# Health checks
HEALTH_CHECK_ENABLED=true

# Distributed tracing
TRACING_ENABLED=true
TRACING_ENDPOINT=              # e.g., http://jaeger:14268/api/traces

# Error tracking (Sentry)
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# =============================================================================
# Backup Configuration
# =============================================================================

# Retention
BACKUP_RETENTION=30           # Days to keep backups

# S3 backup configuration (AWS, MinIO, etc.)
S3_BACKUP_BUCKET=llm-observatory-backups
S3_BACKUP_PREFIX=production/backups/
S3_STORAGE_CLASS=STANDARD_IA  # Options: STANDARD, STANDARD_IA, GLACIER, DEEP_ARCHIVE
S3_KMS_KEY_ID=                # Optional: KMS key for encryption

# AWS credentials (prefer IAM roles or instance profiles)
AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=           # Loaded from secrets/aws_access_key_id.txt
# AWS_SECRET_ACCESS_KEY=       # Loaded from secrets/aws_secret_access_key.txt

# WAL archiving (for Point-in-Time Recovery)
WAL_S3_BUCKET=llm-observatory-wal
WAL_S3_PREFIX=production/wal/
WAL_RETENTION_DAYS=7

# Notification settings
NOTIFICATION_EMAIL=alerts@yourdomain.com

# =============================================================================
# SMTP Configuration (for alerts and notifications)
# =============================================================================

SMTP_ENABLED=true
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USER=notifications@yourdomain.com
SMTP_FROM_ADDRESS=noreply@yourdomain.com
# SMTP_PASSWORD=               # Loaded from secrets/smtp_password.txt

# TLS settings
SMTP_TLS=true
SMTP_STARTTLS=true

# =============================================================================
# LLM Provider Configuration
# =============================================================================

# OpenAI
OPENAI_API_KEY=
OPENAI_ORG_ID=
OPENAI_MAX_RETRIES=3
OPENAI_TIMEOUT=60

# Anthropic
ANTHROPIC_API_KEY=
ANTHROPIC_MAX_RETRIES=3
ANTHROPIC_TIMEOUT=60

# AWS Bedrock (prefer IAM roles)
AWS_BEDROCK_REGION=us-east-1
# AWS_BEDROCK_ACCESS_KEY_ID=
# AWS_BEDROCK_SECRET_ACCESS_KEY=

# Azure OpenAI
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_API_VERSION=2024-02-01

# Google Vertex AI
GOOGLE_CLOUD_PROJECT=
GOOGLE_APPLICATION_CREDENTIALS=/run/secrets/gcp_credentials.json

# =============================================================================
# Security Headers Configuration
# =============================================================================

# Content Security Policy
CSP_DEFAULT_SRC="'self'"
CSP_SCRIPT_SRC="'self' 'unsafe-inline'"
CSP_STYLE_SRC="'self' 'unsafe-inline'"
CSP_IMG_SRC="'self' data: https:"
CSP_FONT_SRC="'self' data:"
CSP_CONNECT_SRC="'self'"
CSP_FRAME_ANCESTORS="'none'"

# HSTS settings
HSTS_MAX_AGE=31536000         # 1 year
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# =============================================================================
# Feature Flags
# =============================================================================

# Authentication
AUTH_ENABLED=true
AUTH_OAUTH_ENABLED=false
AUTH_SAML_ENABLED=false

# API features
API_VERSIONING=true
API_DEPRECATION_WARNINGS=true

# Rate limiting tiers
RATE_LIMIT_TIER_FREE=100
RATE_LIMIT_TIER_BASIC=1000
RATE_LIMIT_TIER_PRO=10000
RATE_LIMIT_TIER_ENTERPRISE=100000

# =============================================================================
# Compliance Configuration
# =============================================================================

# Data retention
DATA_RETENTION_DAYS=365       # Days to keep telemetry data
DATA_ANONYMIZATION_ENABLED=false
DATA_ENCRYPTION_AT_REST=true

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=90

# GDPR compliance
GDPR_MODE=false
GDPR_DATA_EXPORT_ENABLED=false
GDPR_RIGHT_TO_DELETION_ENABLED=false

# =============================================================================
# Performance Tuning
# =============================================================================

# HTTP/2
HTTP2_ENABLED=true
HTTP2_MAX_CONCURRENT_STREAMS=100

# Compression
GZIP_ENABLED=true
GZIP_LEVEL=6
BROTLI_ENABLED=true
BROTLI_LEVEL=4

# Request timeouts
REQUEST_TIMEOUT=30            # seconds
REQUEST_BODY_MAX_SIZE=10485760 # 10MB

# Connection limits
MAX_CONNECTIONS=10000
KEEPALIVE_TIMEOUT=65

# =============================================================================
# Kubernetes/Orchestration Settings (if deploying to K8s)
# =============================================================================

# Namespace
K8S_NAMESPACE=llm-observatory

# Service mesh (Istio/Linkerd)
SERVICE_MESH_ENABLED=false
MTLS_ENABLED=false

# Horizontal Pod Autoscaling
HPA_ENABLED=false
HPA_MIN_REPLICAS=2
HPA_MAX_REPLICAS=10
HPA_CPU_TARGET=70
HPA_MEMORY_TARGET=80

# =============================================================================
# Development/Debug Settings (should be disabled in production)
# =============================================================================

# NEVER enable these in production!
DEBUG=false
AUTO_RELOAD=false
DB_QUERY_LOGGING=false
PROFILE_ENABLED=false

# =============================================================================
# Custom Application Settings
# =============================================================================

# Add your application-specific configuration here

