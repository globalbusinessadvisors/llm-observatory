# ============================================================================
# SQLx Configuration for Storage Service Migrations
# ============================================================================
# This file configures sqlx-cli for running migrations in the storage service
# ============================================================================

[migrations]
# Path to migrations directory (relative to workspace root)
migrations_dir = "crates/storage/migrations"

# Whether to fail if migrations directory doesn't exist
# Set to false for flexible deployment scenarios
fail_on_missing_migrations = false

# Migration naming scheme
# Options: "timestamp" (default), "sequential"
naming = "timestamp"

# Whether to create reversible migrations (up/down)
# Set to false for one-way migrations only
reversible = false

[database]
# Database URL is read from DATABASE_URL environment variable
# Format: postgresql://user:password@host:port/database

# Maximum number of connections in the pool for migration
max_connections = 5

# Connection timeout in seconds
connect_timeout = 30

# Whether to verify TLS certificates
# Set to false for development, true for production
verify_tls = false

# Application name shown in PostgreSQL logs
application_name = "llm-observatory-storage-migrations"

[compile]
# Whether to check queries at compile time
# This requires DATABASE_URL to be set during build
offline = false

# Path to offline query metadata (generated by sqlx prepare)
offline_dir = ".sqlx"

[runtime]
# Whether to use rustls (true) or native-tls (false)
use_rustls = true

# Log level for sqlx operations
# Options: trace, debug, info, warn, error
log_level = "info"

# Whether to log slow queries
log_slow_queries = true

# Slow query threshold in milliseconds
slow_query_threshold_ms = 1000

# ============================================================================
# Usage Examples:
#
# 1. Run all pending migrations:
#    sqlx migrate run --config docker/.sqlx-config.toml
#
# 2. Revert last migration (if reversible):
#    sqlx migrate revert --config docker/.sqlx-config.toml
#
# 3. Check migration status:
#    sqlx migrate info --config docker/.sqlx-config.toml
#
# 4. Generate offline query metadata (for compile-time verification):
#    cargo sqlx prepare --workspace --config docker/.sqlx-config.toml
#
# 5. Verify migrations without running:
#    sqlx migrate dry-run --config docker/.sqlx-config.toml
# ============================================================================
